(function(){function e(){}function t(e){this.buttonBar=u.getElementById("wmd-button-bar"+e),this.preview=u.getElementById("wmd-preview"+e),this.input=u.getElementById("wmd-input"+e)}function n(e,t){var n,i,o,a=this,l=[],d=0,c="none",u=function(e,t){c!=e&&(c=e,t||f()),g.isIE&&"moving"==c?o=null:i=setTimeout(p,1)},p=function(e){o=new r(t,e),i=void 0};this.setCommandMode=function(){c="command",f(),i=setTimeout(p,0)},this.canUndo=function(){return d>1},this.canRedo=function(){return l[d+1]?!0:!1},this.undo=function(){a.canUndo()&&(n?(n.restore(),n=null):(l[d]=new r(t),l[--d].restore(),e&&e())),c="none",t.input.focus(),p()},this.redo=function(){a.canRedo()&&(l[++d].restore(),e&&e()),c="none",t.input.focus(),p()};var f=function(){var i=o||new r(t);return i?"moving"==c?(n||(n=i),void 0):(n&&(l[d-1].text!=n.text&&(l[d++]=n),n=null),l[d++]=i,l[d+1]=null,e&&e(),void 0):!1},h=function(e){var t=!1;if(e.ctrlKey||e.metaKey){var n=e.charCode||e.keyCode,r=String.fromCharCode(n);switch(r){case"y":a.redo(),t=!0;break;case"z":e.shiftKey?a.redo():a.undo(),t=!0}}return t?(e.preventDefault&&e.preventDefault(),window.event&&(window.event.returnValue=!1),void 0):void 0},m=function(e){if(!e.ctrlKey&&!e.metaKey){var t=e.keyCode;t>=33&&40>=t||t>=63232&&63235>=t?u("moving"):8==t||46==t||127==t?u("deleting"):13==t?u("newlines"):27==t?u("escape"):(16>t||t>20)&&91!=t&&u("typing")}},v=function(){s.addEvent(t.input,"keypress",function(e){!e.ctrlKey&&!e.metaKey||89!=e.keyCode&&90!=e.keyCode||e.preventDefault()});var e=function(){(g.isIE||o&&o.text!=t.input.value)&&void 0==i&&(c="paste",f(),p())};s.addEvent(t.input,"keydown",h),s.addEvent(t.input,"keydown",m),s.addEvent(t.input,"mousedown",function(){u("moving")}),t.input&&(t.input.onpaste=e,t.input.ondrop=e)},y=function(){v(),p(!0),f()};y()}function r(t,n){var r=this,i=t.input;this.init=function(){s.isVisible(i)&&(n||!u.activeElement||u.activeElement===i)&&(this.setInputAreaSelectionStartEnd(),this.scrollTop=i.scrollTop,(!this.text&&i.selectionStart||0===i.selectionStart)&&(this.text=i.value))},this.setInputAreaSelection=function(){if(s.isVisible(i))if(void 0===i.selectionStart||g.isOpera){if(u.selection){if(u.activeElement&&u.activeElement!==i)return;i.focus();var e=i.createTextRange();e.moveStart("character",-i.value.length),e.moveEnd("character",-i.value.length),e.moveEnd("character",r.end),e.moveStart("character",r.start),e.select()}}else i.focus(),i.selectionStart=r.start,i.selectionEnd=r.end,i.scrollTop=r.scrollTop},this.setInputAreaSelectionStartEnd=function(){if(t.ieCachedRange||!i.selectionStart&&0!==i.selectionStart){if(u.selection){r.text=s.fixEolChars(i.value);var e=t.ieCachedRange||u.selection.createRange(),n=s.fixEolChars(e.text),o="",a=o+n+o;e.text=a;var l=s.fixEolChars(i.value);e.moveStart("character",-a.length),e.text=n,r.start=l.indexOf(o),r.end=l.lastIndexOf(o)-o.length;var d=r.text.length-s.fixEolChars(i.value).length;if(d){for(e.moveStart("character",-n.length);d--;)n+="\n",r.end+=1;e.text=n}t.ieCachedRange&&(r.scrollTop=t.ieCachedScrollTop),t.ieCachedRange=null,this.setInputAreaSelection()}}else r.start=i.selectionStart,r.end=i.selectionEnd},this.restore=function(){void 0!=r.text&&r.text!=i.value&&(i.value=r.text),this.setInputAreaSelection(),i.scrollTop=r.scrollTop},this.getChunks=function(){var t=new e;return t.before=s.fixEolChars(r.text.substring(0,r.start)),t.startTag="",t.selection=s.fixEolChars(r.text.substring(r.start,r.end)),t.endTag="",t.after=s.fixEolChars(r.text.substring(r.end)),t.scrollTop=r.scrollTop,t},this.setChunks=function(e){e.before=e.before+e.startTag,e.after=e.endTag+e.after,this.start=e.before.length,this.end=e.before.length+e.selection.length,this.text=e.before+e.selection+e.after,this.scrollTop=e.scrollTop},this.init()}function i(e,t,n){var r,i,o,a=3e3,l="delayed",c=function(e,t){e&&(s.addEvent(e,"input",t),e.onpaste=t,e.ondrop=t,s.addEvent(e,"keypress",t),s.addEvent(e,"keydown",t))},p=function(){var e=0;return window.innerHeight?e=window.pageYOffset:u.documentElement&&u.documentElement.scrollTop?e=u.documentElement.scrollTop:u.body&&(e=u.body.scrollTop),e},f=function(){if(t.preview){var n=t.input.value;if(!n||n!=o){o=n;var r=(new Date).getTime();n=e.makeHtml(n);var a=(new Date).getTime();i=a-r,C(n)}}},h=function(){if(r&&(clearTimeout(r),r=void 0),"manual"!==l){var e=0;"delayed"===l&&(e=i),e>a&&(e=a),r=setTimeout(f,e)}},m=function(e){return e.scrollHeight<=e.clientHeight?1:e.scrollTop/(e.scrollHeight-e.clientHeight)},v=function(){t.preview&&(t.preview.scrollTop=(t.preview.scrollHeight-t.preview.clientHeight)*m(t.preview))};this.refresh=function(e){e?(o="",f()):h()},this.processingTime=function(){return i};var y,b=!0,w=function(e){var n=t.preview,r=n.parentNode,i=n.nextSibling;r.removeChild(n),n.innerHTML=e,i?r.insertBefore(n,i):r.appendChild(n)},T=function(e){t.preview.innerHTML=e},x=function(e){if(y)return y(e);try{T(e),y=T}catch(t){y=w,y(e)}},C=function(e){var r=d.getTop(t.input)-p();if(t.preview&&(x(e),n()),v(),b)return b=!1,void 0;var i=d.getTop(t.input)-p();g.isIE?setTimeout(function(){window.scrollBy(0,i-r)},0):window.scrollBy(0,i-r)},k=function(){c(t.input,h),f(),t.preview&&(t.preview.scrollTop=0)};k()}function o(e,t,n,i,o,a){function l(e){if(m.focus(),e.textOp){n&&n.setCommandMode();var o=new r(t);if(!o)return;var a=o.getChunks(),l=function(){m.focus(),a&&o.setChunks(a),o.restore(),i.refresh()},s=e.textOp(a,l);s||l()}e.execute&&e.execute(n)}function d(e,n){var r="0px",i="-20px",o="-40px",a=e.getElementsByTagName("span")[0];n?(a.style.backgroundPosition=e.XShift+" "+r,e.onmouseover=function(){a.style.backgroundPosition=this.XShift+" "+o},e.onmouseout=function(){a.style.backgroundPosition=this.XShift+" "+r},g.isIE&&(e.onmousedown=function(){u.activeElement&&u.activeElement!==t.input||(t.ieCachedRange=document.selection.createRange(),t.ieCachedScrollTop=t.input.scrollTop)}),e.isHelp||(e.onclick=function(){return this.onmouseout&&this.onmouseout(),l(this),!1})):(a.style.backgroundPosition=e.XShift+" "+i,e.onmouseover=e.onmouseout=e.onclick=function(){})}function c(e){return"string"==typeof e&&(e=o[e]),function(){e.apply(o,arguments)}}function p(){var n=t.buttonBar,r=document.createElement("ul");if(r.id="wmd-button-row"+e,r.className="wmd-button-row",n){r=n.appendChild(r);var i=0,o=function(t,n,o,a){var l=document.createElement("li");l.className="wmd-button",l.style.left=i+"px",i+=25;var s=document.createElement("span");return l.id=t+e,l.appendChild(s),l.title=n,l.XShift=o,a&&(l.textOp=a),d(l,!0),r.appendChild(l),l}}var l=function(t){var n=document.createElement("li");n.className="wmd-spacer wmd-spacer"+t,n.id="wmd-spacer"+t+e,r.appendChild(n),i+=25};v.bold=o("wmd-bold-button","Strong <strong> Ctrl+B","0px",c("doBold")),v.italic=o("wmd-italic-button","Emphasis <em> Ctrl+I","-20px",c("doItalic")),l(1),v.link=o("wmd-link-button","Hyperlink <a> Ctrl+L","-40px",c(function(e,t){return this.doLinkOrImage(e,t,!1)})),v.quote=o("wmd-quote-button","Blockquote <blockquote> Ctrl+Q","-60px",c("doBlockquote")),v.code=o("wmd-code-button","Code Sample <pre><code> Ctrl+K","-80px",c("doCode")),v.image=o("wmd-image-button","Image <img> Ctrl+G","-100px",c(function(e,t){return this.doLinkOrImage(e,t,!0)})),l(2),v.olist=o("wmd-olist-button","Numbered List <ol> Ctrl+O","-120px",c(function(e,t){this.doList(e,t,!0)})),v.ulist=o("wmd-ulist-button","Bulleted List <ul> Ctrl+U","-140px",c(function(e,t){this.doList(e,t,!1)})),v.heading=o("wmd-heading-button","Heading <h1>/<h2> Ctrl+H","-160px",c("doHeading")),v.hr=o("wmd-hr-button","Horizontal Rule <hr> Ctrl+R","-180px",c("doHorizontalRule")),l(3),v.undo=o("wmd-undo-button","Undo - Ctrl+Z","-200px",null),v.undo.execute=function(e){e&&e.undo()};var s=/win/.test(f.platform.toLowerCase())?"Redo - Ctrl+Y":"Redo - Ctrl+Shift+Z";if(v.redo=o("wmd-redo-button",s,"-220px",null),v.redo.execute=function(e){e&&e.redo()},a){var u=document.createElement("li"),p=document.createElement("span");u.appendChild(p),u.className="wmd-button wmd-help-button",u.id="wmd-help-button"+e,u.XShift="-240px",u.isHelp=!0,u.style.right="0px",u.title=a.title||w,u.onclick=a.handler,d(u,!0),r.appendChild(u),v.help=u}h()}function h(){n&&(d(v.undo,n.canUndo()),d(v.redo,n.canRedo()))}var m=t.input,v={};p();var y="keydown";g.isOpera&&(y="keypress"),s.addEvent(m,y,function(e){if((e.ctrlKey||e.metaKey)&&!e.altKey){var t=e.charCode||e.keyCode,n=String.fromCharCode(t).toLowerCase();switch(n){case"b":l(v.bold);break;case"i":l(v.italic);break;case"l":l(v.link);break;case"q":l(v.quote);break;case"k":l(v.code);break;case"g":l(v.image);break;case"o":l(v.olist);break;case"u":l(v.ulist);break;case"h":l(v.heading);break;case"r":l(v.hr);break;case"y":l(v.redo);break;case"z":e.shiftKey?l(v.redo):l(v.undo);break;default:return}e.preventDefault&&e.preventDefault(),window.event&&(window.event.returnValue=!1)}}),s.addEvent(m,"keyup",function(e){if(e.shiftKey&&!e.ctrlKey&&!e.metaKey){var t=e.charCode||e.keyCode;13===t&&(fakeButton={},fakeButton.textOp=c("doAutoindent"),l(fakeButton))}}),g.isIE&&s.addEvent(m,"keydown",function(e){var t=e.keyCode;return 27===t?!1:void 0}),this.setUndoRedoButtonStates=h}function a(e){this.hooks=e}function l(e){return e.replace(/^\s*(.*?)(?:\s+"(.+)")?\s*$/,function(e,t,n){return t=t.replace(/\?.*$/,function(e){return e.replace(/\+/g," ")}),t=decodeURIComponent(t),t=encodeURI(t).replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29"),t=t.replace(/\?.*$/,function(e){return e.replace(/\+/g,"%2b")}),n&&(n=n.trim?n.trim():n.replace(/^\s*/,"").replace(/\s*$/,""),n=$.trim(n).replace(/"/g,"quot;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),n?t+' "'+n+'"':t})}var s={},d={},c={},u=window.document,p=window.RegExp,f=window.navigator,h={lineLength:72},g={isIE:/msie/.test(f.userAgent.toLowerCase()),isIE_5or6:/msie 6/.test(f.userAgent.toLowerCase())||/msie 5/.test(f.userAgent.toLowerCase()),isOpera:/opera/.test(f.userAgent.toLowerCase())},m="<p align='justify' style='font-size:15px;text-align: center;'><b>Insert Hyperlink</b></p>",v="<p align='justify' style='font-size:15px;text-align: center;'><b>Chèn ảnh</b></p>",y="http://",b="http://",w="Markdown Editing Help";Markdown.Editor=function(e,r,l){r=r||"";var s=this.hooks=new Markdown.HookCollection;s.addNoop("onPreviewRefresh"),s.addNoop("postBlockquoteCreation"),s.addFalse("insertImageDialog"),this.getConverter=function(){return e};var d,c=this;this.run=function(){if(!d){d=new t(r);var p,f,h=new a(s),g=new i(e,d,function(){s.onPreviewRefresh()});/\?noundo/.test(u.location.href)||(p=new n(function(){g.refresh(),f&&f.setUndoRedoButtonStates()},d)),f=new o(r,d,p,g,h,l),f.setUndoRedoButtonStates();var m=c.refreshPreview=function(){g.refresh(!0)};m()}}},e.prototype.findTags=function(e,t){var n,r=this;e&&(n=s.extendRegExp(e,"","$"),this.before=this.before.replace(n,function(e){return r.startTag=r.startTag+e,""}),n=s.extendRegExp(e,"^",""),this.selection=this.selection.replace(n,function(e){return r.startTag=r.startTag+e,""})),t&&(n=s.extendRegExp(t,"","$"),this.selection=this.selection.replace(n,function(e){return r.endTag=e+r.endTag,""}),n=s.extendRegExp(t,"^",""),this.after=this.after.replace(n,function(e){return r.endTag=e+r.endTag,""}))},e.prototype.trimWhitespace=function(e){var t,n,r=this;e?t=n="":(t=function(e){return r.before+=e,""},n=function(e){return r.after=e+r.after,""}),this.selection=this.selection.replace(/^(\s*)/,t).replace(/(\s*)$/,n)},e.prototype.skipLines=function(e,t,n){void 0===e&&(e=1),void 0===t&&(t=1),e++,t++;var r,i;if(navigator.userAgent.match(/Chrome/)&&"X".match(/()./),this.selection=this.selection.replace(/(^\n*)/,""),this.startTag=this.startTag+p.$1,this.selection=this.selection.replace(/(\n*$)/,""),this.endTag=this.endTag+p.$1,this.startTag=this.startTag.replace(/(^\n*)/,""),this.before=this.before+p.$1,this.endTag=this.endTag.replace(/(\n*$)/,""),this.after=this.after+p.$1,this.before){for(r=i="";e--;)r+="\\n?",i+="\n";n&&(r="\\n*"),this.before=this.before.replace(new p(r+"$",""),i)}if(this.after){for(r=i="";t--;)r+="\\n?",i+="\n";n&&(r="\\n*"),this.after=this.after.replace(new p(r,""),i)}},s.isVisible=function(e){if(window.getComputedStyle){try{var t="none"!==window.getComputedStyle(e,null).getPropertyValue("display")}catch(n){var t=null}return t}return e.currentStyle?"none"!==e.currentStyle.display:void 0},s.addEvent=function(e,t,n){e&&(e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n,!1))},s.removeEvent=function(e,t,n){e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n,!1)},s.fixEolChars=function(e){return e=e.replace(/\r\n/g,"\n"),e=e.replace(/\r/g,"\n")},s.extendRegExp=function(e,t,n){(null===t||void 0===t)&&(t=""),(null===n||void 0===n)&&(n="");var r,i=""+e;return i=i.replace(/\/([gim]*)$/,""),r=p.$1,i=i.replace(/(^\/|\/$)/g,""),i=t+i+n,new p(i,r)},d.getTop=function(e,t){var n=e.offsetTop;if(!t)for(;e=e.offsetParent;)n+=e.offsetTop;return n},d.getHeight=function(e){return e.offsetHeight||e.scrollHeight},d.getWidth=function(e){return e.offsetWidth||e.scrollWidth},d.getPageSize=function(){var e,t,n,r;self.innerHeight&&self.scrollMaxY?(e=u.body.scrollWidth,t=self.innerHeight+self.scrollMaxY):u.body.scrollHeight>u.body.offsetHeight?(e=u.body.scrollWidth,t=u.body.scrollHeight):(e=u.body.offsetWidth,t=u.body.offsetHeight),self.innerHeight?(n=self.innerWidth,r=self.innerHeight):u.documentElement&&u.documentElement.clientHeight?(n=u.documentElement.clientWidth,r=u.documentElement.clientHeight):u.body&&(n=u.body.clientWidth,r=u.body.clientHeight);var i=Math.max(e,n),o=Math.max(t,r);return[i,o,n,r]},c.createBackground=function(){var e=u.createElement("div"),t=e.style;e.className="wmd-prompt-background",t.position="absolute",t.top="0",t.zIndex="1000",g.isIE?t.filter="alpha(opacity=50)":t.opacity="0.5";var n=d.getPageSize();return t.height=n[1]+"px",g.isIE?(t.left=u.documentElement.scrollLeft,t.width=u.documentElement.clientWidth):(t.left="0",t.width="100%"),u.body.appendChild(e),e},c.prompt=function(e,t,n){var r,i;void 0===t&&(t="");var o=function(e){var t=e.charCode||e.keyCode;27===t&&a(!0)},a=function(e,t,a){s.removeEvent(u.body,"keydown",o);var l=i.value;if(t){if(e)return l=null,r.parentNode.removeChild(r),n(l),!1;if(!a)return $("#ImageUploadProgress").hide(),r.parentNode.removeChild(r),!1;var d=a?a.name:"";return d.lastIndexOf("png")===d.length-3||d.lastIndexOf("jpg")===d.length-3?($("#ImageUploadProgress").hide(),r.parentNode.removeChild(r),!1):($("#message_image").hide(),$("#error_image").show(),!1)}if(e)return l=null,r.parentNode.removeChild(r),n(l),!1;var l=i.value;return l.lastIndexOf("png")===l.length-3||l.lastIndexOf("jpg")===l.length-3?(l=l.replace("http://http://","http://"),l=l.replace("http://https://","https://"),l=l.replace("http://ftp://","ftp://"),-1===l.indexOf("http://")&&-1===l.indexOf("ftp://")&&-1===l.indexOf("https://")&&(l="http://"+l),r.parentNode.removeChild(r),n(l),!1):($("#message_url").hide(),$("#error_url").show(),!1)},l=function(){r=u.createElement("div"),r.className="wmd-prompt-dialog",r.style.padding="10px;",r.style.position="fixed",r.style.width="50%",r.style.display="block",r.style.zIndex="1001";var l=u.createElement("div");l.innerHTML=e,l.style.padding="5px",r.appendChild(l);var c=u.createElement("p");c.style.textDecoration="none",r.appendChild(c);var p=u.createElement("a");p.href="#",p.id="upload-image-button",p.onclick=function(){return $("#divImgForm").show(),$("#divURLForm").hide(),$("#divGalleryForm").hide(),$("#upload-image-button").addClass("selected"),$("#upload-url-button").removeClass("selected"),$("#insert-image-button").removeClass("selected"),!1},p.className="wmd-mini-button selected",p.innerHTML="Từ máy tính",p.style.padding="5px",p.style.textDecoration="none",c.appendChild(p);var f=u.createElement("a");f.href="#",f.className="wmd-mini-button",f.id="upload-url-button",f.onclick=function(){return $("#divImgForm").hide(),$("#divGalleryForm").hide(),$("#divURLForm").show(),$("#upload-url-button").addClass("selected"),$("#upload-image-button").removeClass("selected"),$("#insert-image-button").removeClass("selected"),!1},f.innerHTML="Nhập URL",f.style.padding="5px",f.style.textDecoration="none",c.appendChild(f);var h,m=u.createElement("a");m.href="#",m.className="wmd-mini-button",m.id="insert-image-button",m.onclick=function(){return $("#divImgForm").hide(),$("#divURLForm").hide(),$("#divGalleryForm").show(),$("#insert-image-button").addClass("selected"),$("#upload-image-button").removeClass("selected"),$("#upload-url-button").removeClass("selected"),"undefined"!=typeof hw_imgur&&(console.log(10),hw_imgur.load_images(R,{selected_item_event:function(e,t){h={link:jQuery(t).attr("src"),title:jQuery(t).attr("title"),alt:jQuery(t).attr("alt"),id:jQuery(t).data("id")}},success:function(){}})),!1},m.innerHTML="Thư viện",m.style.padding="5px",m.style.textDecoration="none",c.appendChild(m);var v=u.createElement("div");v.id="divImgForm",r.appendChild(v);var y=u.createElement("div");y.id="divURLForm",y.style.display="none",r.appendChild(y);var b=u.createElement("div");b.id="divGalleryForm",b.style.display="none",r.appendChild(b);var w=u.createElement("form"),T=w.style;w.onsubmit=function(){return a(!1,!0)},w.method="post",jQuery(w).addClass("dropzone").attr({id:"myZone",action:qa_root+"qa-plugin/hw-imgur/imgur/upload.php"}),w.enctype="multipart/form-data",T.padding="0",T.margin="0",T.marginBottom="5px",T.cssFloat="left",T.width="100%",T.textAlign="center",T.position="relative",v.appendChild(w);var x=u.createElement("div");x.id="upload-file-input",jQuery(x).addClass("fallback"),T=x.style,T.position="relative",T.height="40px",w.appendChild(x);var C=jQuery("<div/>").addClass("dz-default dz-message").append(jQuery("<span/>").html("Kéo file ảnh vào đây để upload."));jQuery(x).append(C);var k=u.createElement("input");k.type="file",k.name="filename",k.id="filename-input",T=k.style,T.verticalAlign="middle",T.border="0",x.appendChild(k);var E=u.createElement("p");E.id="message_image",E.innerHTML="click browse to choose an image from your computer",T=E.style,x.appendChild(E);var L=u.createElement("div");L.id="ImageUploadProgress",L.innerHTML="Uploading ... <div class='image_upload_progress' style='float:right;'></div>",T=L.style,T.backgroundColor="transparent",T.marginTop="10px",T.display="none",x.appendChild(L);var H=u.createElement("p");H.id="error_image",H.innerHTML="You have not selected any file or format is not supported",T=H.style,T.color="#8B0000",T.display="none",x.appendChild(H);var S=u.createElement("input");S.type="button",S.className="upload_button_style hw-button",S.onclick=function(){return a(!0,!0)},S.value="Hủy",T=S.style,T.margin="10px",T.display="inline",T.width="7em",T.marginTop="0px",jQuery(S).css({"float":"right"}),jQuery(w).parent().append(S),jQuery(document).ready(function(){Dropzone.autoDiscover=!1;var e={addRemoveLinks:!0,paramName:"file",maxFilesize:5,accept:function(e,t){"justinbieber.jpg"==e.name?t("Naha, you don't."):t()},method:"post",init:function(){this.on("addedfile",function(){console.log("Added file.")}),this.on("success",function(e){console.log("result:",e),hw=e;var t=e.xhr.response;t=JSON.parse(t),t.error?(alert("Lỗi:"+t.message),n("","Lỗi: "+t.message)):"success"==t.result&&(console.log("newURL:",t.link),n(t.link,t.title)),a(!1,!0,e)});var e=u.createElement("input");e.type="hidden",e.name="_nonce",e.id="hw-upload-nonce",hw_imgur.upload_token&&jQuery(e).attr("value",hw_imgur.upload_token),jQuery(w).append("Kéo ảnh từ máy tính vào đây hoặc nhấn để chọn ảnh."),jQuery(w).append(e)},error:function(e){e.previewElement.classList.add("dz-error")}};jQuery(w).dropzone(e)});var I=u.createElement("form"),T=I.style;I.onsubmit=function(){return a(!1,!1)},I.method="post",I.enctype="multipart/form-data",T.padding="0",T.margin="0",T.marginBottom="5px",T.cssFloat="left",T.width="100%",T.textAlign="center",T.position="relative",b.appendChild(I);var R=u.createElement("div");jQuery(R).addClass("hw-galleries"),jQuery(b).append(R);var _=u.createElement("a");jQuery(_).addClass("hw-button").html("Chèn").css({margin:"10px","float":"right"}),jQuery(_).bind("click",function(e){if(e.preventDefault(),!h)return alert("Vui lòng chọn hình ?"),void 0;a(!1,!0);var t=h.link,r=h.title;n(t,r)}),jQuery(b).append(_);var B=u.createElement("a");jQuery(B).addClass("hw-button").html("Hủy").css({margin:"10px","float":"right"}),B.onclick=function(){return a(!0,!0)},jQuery(b).append(B);var j=u.createElement("form"),T=j.style;j.onsubmit=function(){return a(!1,!1)},j.method="post",j.enctype="multipart/form-data",T.padding="0",T.margin="0",T.marginBottom="5px",T.cssFloat="left",T.width="100%",T.textAlign="center",T.position="relative",y.appendChild(j);var N=u.createElement("div");N.id="upload-url-input",T=N.style,T.height="40px",j.appendChild(N),i=u.createElement("input"),i.type="input",i.name="upload-url",i.value=t,T=i.style,T.display="block",T.width="80%",T.marginLeft=T.marginRight="auto",N.appendChild(i);var Q=u.createElement("p");Q.id="message_url",Q.innerHTML="paste the URL of your image above",T=Q.style,N.appendChild(Q);var O=u.createElement("p");O.id="error_url",O.innerHTML="URL given is not a valid image, it should end with .jpg or .png ",T=O.style,T.color="#8B0000",T.display="none",N.appendChild(O);var D=u.createElement("input");D.type="submit",D.id="uploadButtonURL",D.className="upload_button_style hw-button",D.onclick=function(){return a(!1,!1)},D.value="Tải lên",T=D.style,T.margin="10px",T.display="inline",T.width="7em",T.marginTop="18px",jQuery(D).css({"float":"right"});var M=u.createElement("input");M.type="button",M.className="upload_button_style hw-button",M.onclick=function(){return a(!0,!1)},M.value="Hủy",T=M.style,T.margin="10px",T.display="inline",T.width="7em",T.marginTop="18px",jQuery(M).css({"float":"right"}),j.appendChild(D),j.appendChild(M),s.addEvent(u.body,"keydown",o),r.style.top="50%",r.style.left="50%",r.style.display="block",g.isIE_5or6&&(r.style.position="absolute",r.style.top=u.documentElement.scrollTop+200+"px",r.style.left="50%"),u.body.appendChild(r),r.style.marginTop=-(d.getHeight(r)/2)+"px",r.style.marginLeft=-(d.getWidth(r)/2)+"px",jQuery(c).add(v).add(y).add(b).hide(),hw_imgur.get_session(r,function(e){jQuery(c).add(v).show(),console.log("imgur-markdown.editor.js: get_session:",e)}),jQuery(r).draggable()};setTimeout(function(){l();var e=t.length;if(void 0!==i.selectionStart)i.selectionStart=0,i.selectionEnd=e;else if(i.createTextRange){var n=i.createTextRange();n.collapse(!1),n.moveStart("character",-e),n.moveEnd("character",e),n.select()}i.focus()},0)},c.prompt_link=function(e,t,n){var r,i;void 0===t&&(t="");var o=function(e){var t=e.charCode||e.keyCode;27===t&&a(!0)},a=function(e){s.removeEvent(u.body,"keydown",o);var t=i.value;return e?t=null:(t=t.replace("http://http://","http://"),t=t.replace("http://https://","https://"),t=t.replace("http://ftp://","ftp://"),-1===t.indexOf("http://")&&-1===t.indexOf("ftp://")&&-1===t.indexOf("https://")&&(t="http://"+t)),r.parentNode.removeChild(r),n(t),!1},l=function(){r=u.createElement("div"),r.className="wmd-prompt-dialog",r.style.padding="10px;",r.style.position="fixed",r.style.width="50%",r.style.zIndex="1001";var n=u.createElement("div");n.innerHTML=e,n.style.padding="5px",r.appendChild(n);var l=u.createElement("form"),c=l.style;l.onsubmit=function(){return a(!1)},c.padding="0",c.margin="0",c.cssFloat="left",c.width="100%",c.textAlign="center",c.position="relative",r.appendChild(l),i=u.createElement("input"),i.type="text",i.value=t,c=i.style,c.display="block",c.width="80%",c.marginLeft=c.marginRight="auto",l.appendChild(i);var p=u.createElement("p");p.id="message_link",p.innerHTML="http://hoangweb.com/",c=p.style,l.appendChild(p);var f=u.createElement("input");f.type="button",f.className="upload_button_style",f.onclick=function(){return a(!1)},f.value="OK",c=f.style,c.margin="10px",c.display="inline",c.width="7em";var h=u.createElement("input");h.type="button",h.className="upload_button_style",h.onclick=function(){return a(!0)},h.value="Cancel",c=h.style,c.margin="10px",c.display="inline",c.width="7em",l.appendChild(f),l.appendChild(h),s.addEvent(u.body,"keydown",o),r.style.top="50%",r.style.left="50%",r.style.display="block",g.isIE_5or6&&(r.style.position="absolute",r.style.top=u.documentElement.scrollTop+200+"px",r.style.left="50%"),u.body.appendChild(r),r.style.marginTop=-(d.getHeight(r)/2)+"px",r.style.marginLeft=-(d.getWidth(r)/2)+"px",jQuery(r).draggable(),dlg=r};setTimeout(function(){l();var e=t.length;if(void 0!==i.selectionStart)i.selectionStart=0,i.selectionEnd=e;else if(i.createTextRange){var n=i.createTextRange();n.collapse(!1),n.moveStart("character",-e),n.moveEnd("character",e),n.select()}i.focus()},0)};var T=a.prototype;T.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)",T.unwrap=function(e){var t=new p("([^\\n])\\n(?!(\\n|"+this.prefixes+"))","g");e.selection=e.selection.replace(t,"$1 $2")},T.wrap=function(e,t){this.unwrap(e);var n=new p("(.{1,"+t+"})( +|$\\n?)","gm"),r=this;e.selection=e.selection.replace(n,function(e,t){return new p("^"+r.prefixes,"").test(e)?e:t+"\n"}),e.selection=e.selection.replace(/\s+$/,"")},T.doBold=function(e,t){return this.doBorI(e,t,2,"strong text")},T.doItalic=function(e,t){return this.doBorI(e,t,1,"emphasized text")},T.doBorI=function(e,t,n,r){e.trimWhitespace(),e.selection=e.selection.replace(/\n{2,}/g,"\n");var i=/(\**$)/.exec(e.before)[0],o=/(^\**)/.exec(e.after)[0],a=Math.min(i.length,o.length);if(a>=n&&(2!=a||1!=n))e.before=e.before.replace(p("[*]{"+n+"}$",""),""),e.after=e.after.replace(p("^[*]{"+n+"}",""),"");else if(!e.selection&&o){e.after=e.after.replace(/^([*_]*)/,""),e.before=e.before.replace(/(\s?)$/,"");var l=p.$1;e.before=e.before+o+l}else{e.selection||o||(e.selection=r);var s=1>=n?"*":"**";e.before=e.before+s,e.after=s+e.after}},T.stripLinkDefs=function(e,t){return e=e.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,function(e,n,r,i,o){return t[n]=e.replace(/\s*$/,""),i?(t[n]=e.replace(/["(](.+?)[")]$/,""),i+o):""})},T.addLinkDef=function(e,t){var n=0,r={};e.before=this.stripLinkDefs(e.before,r),e.selection=this.stripLinkDefs(e.selection,r),e.after=this.stripLinkDefs(e.after,r);var i="",o=/(\[)((?:\[[^\]]*\]|[^\[\]])*)(\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g,a=function(e){n++,e=e.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+n+"]:"),i+="\n"+e},l=function(e,t,i,s,d,c){return i=i.replace(o,l),r[d]?(a(r[d]),t+i+s+n+c):e};e.before=e.before.replace(o,l),t?a(t):e.selection=e.selection.replace(o,l);var s=n;return e.after=e.after.replace(o,l),e.after&&(e.after=e.after.replace(/\n*$/,"")),e.after||(e.selection=e.selection.replace(/\n*$/,"")),e.after+="\n\n"+i,s},T.doLinkOrImage=function(e,t,n){e.trimWhitespace(),e.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/);var r;if(!(e.endTag.length>1&&e.startTag.length>0)){if(e.selection=e.startTag+e.selection+e.endTag,e.startTag=e.endTag="",/\n\n/.test(e.selection))return this.addLinkDef(e,null),void 0;var i=this,o=function(o,a){if(r.parentNode.removeChild(r),null!==o){e.selection=(" "+e.selection).replace(/([^\\](?:\\\\)*)(?=[[\]])/g,"$1\\").substr(1);var s=" [999]: "+l(o),d=i.addLinkDef(e,s);e.startTag=n?"![":"[",e.endTag="]["+d+"]",e.selection||(e.selection=n?a?a:"enter image description here":a?a:"enter link description here")}t()};return r=c.createBackground(),n?this.hooks.insertImageDialog(o)||c.prompt(v,y,o):c.prompt_link(m,b,o),!0}e.startTag=e.startTag.replace(/!?\[/,""),e.endTag="",this.addLinkDef(e,null)},T.doAutoindent=function(e){var t=this;e.before=e.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n"),e.before=e.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n"),e.before=e.before.replace(/(\n|^)[ \t]+\n$/,"\n\n"),/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]+.*\n$/.test(e.before)&&t.doList&&t.doList(e),/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(e.before)&&t.doBlockquote&&t.doBlockquote(e),/(\n|^)(\t|[ ]{4,}).*\n$/.test(e.before)&&t.doCode&&t.doCode(e)},T.doBlockquote=function(e){e.selection=e.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,function(t,n,r,i){return e.before+=n,e.after=i+e.after,r}),e.before=e.before.replace(/(>[ \t]*)$/,function(t,n){return e.selection=n+e.selection,""}),e.selection=e.selection.replace(/^(\s|>)+$/,""),e.selection=e.selection||"Blockquote";var t,n="",r="";if(e.before){for(var i=e.before.replace(/\n$/,"").split("\n"),o=!1,a=0;i.length>a;a++){var l=!1;t=i[a],o=o&&t.length>0,/^>/.test(t)?(l=!0,!o&&t.length>1&&(o=!0)):l=/^[ \t]*$/.test(t)?!0:o,l?n+=t+"\n":(r+=n+t,n="\n")}/(^|\n)>/.test(n)||(r+=n,n="")}e.startTag=n,e.before=r,e.after&&(e.after=e.after.replace(/^\n?/,"\n")),e.after=e.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,function(t){return e.endTag=t,""});var s=function(t){var n=t?"> ":"";e.startTag&&(e.startTag=e.startTag.replace(/\n((>|\s)*)\n$/,function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,n)+"\n"})),e.endTag&&(e.endTag=e.endTag.replace(/^\n((>|\s)*)\n/,function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,n)+"\n"}))};/^(?![ ]{0,3}>)/m.test(e.selection)?(this.wrap(e,h.lineLength-2),e.selection=e.selection.replace(/^/gm,"> "),s(!0),e.skipLines()):(e.selection=e.selection.replace(/^[ ]{0,3}> ?/gm,""),this.unwrap(e),s(!1),!/^(\n|^)[ ]{0,3}>/.test(e.selection)&&e.startTag&&(e.startTag=e.startTag.replace(/\n{0,2}$/,"\n\n")),!/(\n|^)[ ]{0,3}>.*$/.test(e.selection)&&e.endTag&&(e.endTag=e.endTag.replace(/^\n{0,2}/,"\n\n"))),e.selection=this.hooks.postBlockquoteCreation(e.selection),/\n/.test(e.selection)||(e.selection=e.selection.replace(/^(> *)/,function(t,n){return e.startTag+=n,""}))},T.doCode=function(e){var t=/\S[ ]*$/.test(e.before),n=/^[ ]*\S/.test(e.after);if(!n&&!t||/\n/.test(e.selection)){e.before=e.before.replace(/[ ]{4}$/,function(t){return e.selection=t+e.selection,""});var r=1,i=1;/\n(\t|[ ]{4,}).*\n$/.test(e.before)&&(r=0),/^\n(\t|[ ]{4,})/.test(e.after)&&(i=0),e.skipLines(r,i),e.selection?e.selection=/^[ ]{0,3}\S/m.test(e.selection)?e.selection.replace(/^/gm,"    "):e.selection.replace(/^[ ]{4}/gm,""):(e.startTag="    ",e.selection="enter code here")}else e.trimWhitespace(),e.findTags(/`/,/`/),e.startTag||e.endTag?e.endTag&&!e.startTag?(e.before+=e.endTag,e.endTag=""):e.startTag=e.endTag="":(e.startTag=e.endTag="`",e.selection||(e.selection="enter code here"))},T.doList=function(e,t,n){var r=/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/,i=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/,o="-",a=1,l=function(){var e;return n?(e=" "+a+". ",a++):e=" "+o+" ",e},s=function(e){return void 0===n&&(n=/^\s*\d/.test(e)),e=e.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,function(){return l()})};if(e.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null),!e.before||/\n$/.test(e.before)||/^\n/.test(e.startTag)||(e.before+=e.startTag,e.startTag=""),e.startTag){var d=/\d+[.]/.test(e.startTag);if(e.startTag="",e.selection=e.selection.replace(/\n[ ]{4}/g,"\n"),this.unwrap(e),e.skipLines(),d&&(e.after=e.after.replace(i,s)),n==d)return}var c=1;e.before=e.before.replace(r,function(e){return/^\s*([*+-])/.test(e)&&(o=p.$1),c=/[^\n]\n\n[^\n]/.test(e)?1:0,s(e)}),e.selection||(e.selection="List item");var u=l(),f=1;e.after=e.after.replace(i,function(e){return f=/[^\n]\n\n[^\n]/.test(e)?1:0,s(e)}),e.trimWhitespace(!0),e.skipLines(c,f,!0),e.startTag=u;var g=u.replace(/./g," ");this.wrap(e,h.lineLength-g.length),e.selection=e.selection.replace(/\n/g,"\n"+g)},T.doHeading=function(e){if(e.selection=e.selection.replace(/\s+/g," "),e.selection=e.selection.replace(/(^\s+|\s+$)/g,""),!e.selection)return e.startTag="## ",e.selection="Heading",e.endTag=" ##",void 0;var t=0;e.findTags(/#+[ ]*/,/[ ]*#+/),/#+/.test(e.startTag)&&(t=p.lastMatch.length),e.startTag=e.endTag="",e.findTags(null,/\s?(-+|=+)/),/=+/.test(e.endTag)&&(t=1),/-+/.test(e.endTag)&&(t=2),e.startTag=e.endTag="",e.skipLines(1,1);var n=0==t?2:t-1;if(n>0){var r=n>=2?"-":"=",i=e.selection.length;for(i>h.lineLength&&(i=h.lineLength),e.endTag="\n";i--;)e.endTag+=r
}},T.doHorizontalRule=function(e){e.startTag="----------\n",e.selection="",e.skipLines(2,1,!0)}})();